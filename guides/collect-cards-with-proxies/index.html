<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>Collect and Use Credit Cards with Proxies - Basis Theory Guides</title> <meta name="Description" content="Basis Theory"> <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Collect and Use Credit Cards with Proxies | Basis Theory Guides</title> <meta name="generator" content="Jekyll v4.2.2" /> <meta property="og:title" content="Collect and Use Credit Cards with Proxies" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Basis Theory" /> <meta property="og:description" content="Basis Theory" /> <link rel="canonical" href="https://developers.basistheory.com/guides/collect-cards-with-proxies/" /> <meta property="og:url" content="https://developers.basistheory.com/guides/collect-cards-with-proxies/" /> <meta property="og:site_name" content="Basis Theory Guides" /> <meta property="og:image" content="https://cdn.basistheory.com/images/seo/guides-opengraph.png" /> <meta property="og:image:height" content="630" /> <meta property="og:image:width" content="1200" /> <meta property="og:type" content="website" /> <meta name="twitter:card" content="summary_large_image" /> <meta property="twitter:image" content="https://cdn.basistheory.com/images/seo/guides-opengraph.png" /> <meta property="twitter:title" content="Collect and Use Credit Cards with Proxies" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"Basis Theory","headline":"Collect and Use Credit Cards with Proxies","image":{"width":1200,"height":630,"url":"https://cdn.basistheory.com/images/seo/guides-opengraph.png","@type":"imageObject"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://developers.basistheory.com/assets/images/logos-guides.svg"}},"url":"https://developers.basistheory.com/guides/collect-cards-with-proxies/"}</script> <!-- End Jekyll SEO tag --> </head> <script defer data-api="https://analytics.basistheory.com/api/event" data-domain="developers.basistheory.com" src="https://cdn.basistheory.com/javascript/analytics.js"></script> <!-- Google Tag Manager --> <script>(function (w, d, s, l, i) { w[l] = w[l] || []; w[l].push({ 'gtm.start': new Date().getTime(), event: 'gtm.js' }); var f = d.getElementsByTagName(s)[0], j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : ''; j.async = true; j.src = 'https://www.googletagmanager.com/gtm.js?id=' + i + dl; f.parentNode.insertBefore(j, f); })(window, document, 'script', 'dataLayer', 'GTM-M56229L');</script> <!-- End Google Tag Manager --> <!-- Iubenda --> <script type="text/javascript"> var _iub = _iub || []; _iub.csConfiguration = { "ccpaAcknowledgeOnLoad": true, "consentOnContinuedBrowsing": false, "countryDetection": true, "gdprAppliesGlobally": false, "lang": "en", "siteId": 2378844, "cookiePolicyId": 13137791, "callback": { "onPreferenceExpressedOrNotNeeded": function (preference) { dataLayer.push({ iubenda_ccpa_opted_out: _iub.cs.api.isCcpaOptedOut() }); if (!preference) { dataLayer.push({ event: "iubenda_preference_not_needed" }); } else { if (preference.consent === true) { dataLayer.push({ event: "iubenda_consent_given" }); } else if (preference.consent === false) { dataLayer.push({ event: "iubenda_consent_rejected" }); } else if (preference.purposes) { for (var purposeId in preference.purposes) { if (preference.purposes[purposeId]) { dataLayer.push({ event: "iubenda_consent_given_purpose_" + purposeId }); } } } } } }, "banner": { "acceptButtonCaptionColor": "#070a1b", "acceptButtonColor": "#1ad1db", "acceptButtonDisplay": true, "backgroundColor": "#141729", "closeButtonDisplay": false, "customizeButtonCaptionColor": "#d2d2d2", "customizeButtonColor": "#1a1e32", "customizeButtonDisplay": true, "position": "bottom", "rejectButtonCaptionColor": "white", "rejectButtonColor": "#1e2337", "rejectButtonDisplay": true, "textColor": "#e5e6ec", "acceptButtonCaption": "Accept All", "content": "<link rel=\"preconnect\" href=\"https://fonts.googleapis.com\" />\n<link rel=\"preconnect\" href=\"https://fonts.gstatic.com\" crossOrigin=\"true\" />\n<link href=\"https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700;800;900&display=swap\" rel=\"stylesheet\" />\n<style>\ndiv#iubenda-cs-banner {\n font-size: 16px !important;\n font-family: 'Inter', sans-serif, -apple-system, sans-serif !important;\n}\n\ndiv#iubenda-cs-banner div.iubenda-cs-container {\n border-top: 1px solid #2f3244 !important;\n}\n\ndiv#iubenda-cs-banner .iubenda-banner-content {\n font-family: 'Inter', sans-serif, -apple-system, sans-serif !important;\n font-weight: 400 !important;\n color: #8389a6 !important;\n font-size: 14px !important; \n}\n\ndiv#iubenda-cs-title {\n color: #E5E6EC !important;\n font-size: 16px !important;\n}\n\ndiv#iubenda-cs-banner div.iubenda-cs-opt-group button {\n padding: 12px 32px !important;\n font-weight: 600 !important;\n border-radius: 4px !important;\n}\n\nbutton.iubenda-cs-accept-btn {\n box-shadow: 1px 1px 3px 0 rgb(49 255 255 / 30%), inset 0 0 0 1px hsl(0deg 0% 100% / 40%);\n margin-left: 16px !important;\n}\n\n@media (min-width: 992px) {\n #iubenda-cs-banner.iubenda-cs-default div.iubenda-cs-rationale {\n max-width: 1200px !important;\n width: 100% !important;\n }\n}\n</style><div id=\"iubenda-cs-title\">&#x1f36a; &nbsp;Cookie Notice</div><div id=\"iubenda-cs-paragraph\">\n\nBy clicking \"Accept All\", you agree to the storing of cookies on your device to enhance site navigation, analyze site usage, and assist in our marketing efforts. View our <a href=\"https://basistheory.com/privacy-policy\" target=\"_blank\">Cookie Policy</a> for more information.\n</div>", "rejectButtonCaption": "" } }; </script> <script type="text/javascript" src="//cdn.iubenda.com/cs/iubenda_cs.js" charset="UTF-8" async></script> <!-- End Iubenda --> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path> <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle> <line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line> <line x1="3" y1="6" x2="21" y2="6"></line> <line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path> <polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <header class="site-header"> <a class="site-header-logo" href="https://developers.basistheory.com/"> </a> <div class="documentation-links"> <a class="documentation-link " href="/getting-started">Get Started</a> <a class="documentation-link active" href="/">Documentation</a> <a class="documentation-link" href="https://docs.basistheory.com/api-reference/#introduction">API Reference</a> <a class="documentation-link" href="https://docs.basistheory.com/elements/#introduction">Elements</a> </div> <div class="portal-links"> <a class="portal-sign-in" href="https://portal.basistheory.com">Sign In</a> <a class="portal-create-account" href="https://portal.basistheory.com/register">Create Account</a> </div> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"> <use xlink:href="#svg-menu"></use> </svg> </a> </header> <div class="side-bar"> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <div class="nav-list"><a class="side-bar-category home-link" href="/"> <div class="icon-and-category-name"> <div class="home-icon category-icon-spacing "></div> <div class="side-bar-category-name home-link ">Home</div> </div> </a> <div class="side-bar-category" id="getting-started-category-name-and-icon"> <div class="icon-and-category-name"> <div class="getting-started-icon category-icon-spacing "></div> <div class="side-bar-category-name ">Getting Started</div> </div> <a class="category-expander" id="getting-started-category-expander"></a> </div> <div class="side-bar-category-items" id="getting-started-category-items"><div class="nav-list-item"> <a href="https://developers.basistheory.com/getting-started/quickstart-with-curl/" class="nav-list-link ">Quickstart with cURL</a> </div><div class="nav-list-item"> <a href="https://developers.basistheory.com/getting-started/quickstart-with-nodejs/" class="nav-list-link ">Quickstart with Node.js</a> </div><div class="nav-list-item"> <a href="https://developers.basistheory.com/getting-started/quickstart-with-python/" class="nav-list-link ">Quickstart with Python</a> </div><div class="nav-list-item"> <a href="https://developers.basistheory.com/getting-started/quickstart-with-ruby/" class="nav-list-link ">Quickstart with Ruby</a> </div><div class="nav-list-item"> <a href="https://developers.basistheory.com/getting-started/quickstart-with-dotnet/" class="nav-list-link ">Quickstart with .NET</a> </div><div class="nav-list-item"> <a href="https://developers.basistheory.com/getting-started/quickstart-with-java/" class="nav-list-link ">Quickstart with Java</a> </div><div class="nav-list-item"> <a href="https://developers.basistheory.com/getting-started/quickstart-with-go/" class="nav-list-link ">Quickstart with Go</a> </div></div> <div class="side-bar-category" id="blueprints-category-name-and-icon"> <div class="icon-and-category-name"> <div class="blueprints-icon category-icon-spacing "></div> <div class="side-bar-category-name ">Blueprints</div> </div> <a class="category-expander" id="blueprints-category-expander"></a> </div> <div class="side-bar-category-items" id="blueprints-category-items"><div class="nav-list-item"> <a href="https://developers.basistheory.com/blueprints/pci/" class="nav-list-link ">PCI Blueprint</a> </div></div> <div class="side-bar-category" id="concepts-category-name-and-icon"> <div class="icon-and-category-name"> <div class="concepts-icon category-icon-spacing "></div> <div class="side-bar-category-name ">Concepts</div> </div> <a class="category-expander" id="concepts-category-expander"></a> </div> <div class="side-bar-category-items" id="concepts-category-items"><div class="nav-list-item"> <a href="https://developers.basistheory.com/concepts/what-are-tokens/" class="nav-list-link ">Tokens</a> </div><div class="nav-list-item"> <a href="https://developers.basistheory.com/concepts/what-are-token-containers/" class="nav-list-link ">Token Containers</a> </div><div class="nav-list-item"> <a href="https://developers.basistheory.com/concepts/access-controls/" class="nav-list-link ">Access Controls</a> </div><div class="nav-list-item"> <a href="https://developers.basistheory.com/concepts/what-is-the-proxy/" class="nav-list-link ">Proxy</a> </div><div class="nav-list-item"> <a href="https://developers.basistheory.com/concepts/what-are-reactors/" class="nav-list-link ">Reactors</a> </div><div class="nav-list-item"> <a href="https://developers.basistheory.com/concepts/what-is-search/" class="nav-list-link ">Search</a> </div><div class="nav-list-item"> <a href="https://developers.basistheory.com/concepts/what-are-mats/" class="nav-list-link ">Monthly Active Tokens</a> </div></div> <div class="side-bar-category" id="guides-category-name-and-icon"> <div class="icon-and-category-name"> <div class="guides-icon category-icon-spacing active"></div> <div class="side-bar-category-name active">Guides</div> </div> <a class="category-expander" id="guides-category-expander"></a> </div> <div class="side-bar-category-items" id="guides-category-items"> <div class="guide-subcategory-title">SECURE YOUR DATA</div><div class="nav-list-item"> <a href="https://developers.basistheory.com/guides/collect-pii-js/" class="nav-list-link ">Collect Customer Data (PII) with JavaScript</a> </div><div class="nav-list-item"> <a href="https://developers.basistheory.com/guides/collect-pii-react/" class="nav-list-link ">Collect Customer Data (PII) with React</a> </div><div class="nav-list-item"> <a href="https://developers.basistheory.com/guides/collect-cards-with-elements-react/" class="nav-list-link ">Collect Credit Cards with React</a> </div><div class="nav-list-item"> <a href="https://developers.basistheory.com/guides/style-elements-for-my-brand/" class="nav-list-link ">Styling Elements</a> </div><div class="nav-list-item"> <a href="https://developers.basistheory.com/guides/encrypt-us-banks-in-your-applications/" class="nav-list-link ">Encrypt U.S. Banks in your applications</a> </div><div class="guide-subcategory-title">USE YOUR DATA</div><div class="nav-list-item"> <a href="https://developers.basistheory.com/guides/collect-cards-with-elements/" class="nav-list-link ">Collect and Charge Credit Cards with JavaScript</a> </div><div class="nav-list-item"> <a href="https://developers.basistheory.com/guides/use-us-bank-accounts-without-touching-them/" class="nav-list-link ">Use U.S. Bank Accounts without touching them</a> </div><div class="nav-list-item"> <a href="https://developers.basistheory.com/guides/reveal-cards-with-react/" class="nav-list-link ">Reveal Card Data with React</a> </div><div class="nav-list-item"> <a href="https://developers.basistheory.com/guides/use-token-data-in-reactors/" class="nav-list-link ">Use Token Data in Reactors</a> </div><div class="nav-list-item"> <a href="https://developers.basistheory.com/guides/use-token-data-in-http-requests/" class="nav-list-link ">Use Token Data in HTTP Requests</a> </div><div class="nav-list-item"> <a href="https://developers.basistheory.com/guides/run-your-own-code-in-a-reactor/" class="nav-list-link ">Run Your Own Code in a Reactor</a> </div><div class="nav-list-item active"> <a href="https://developers.basistheory.com/guides/collect-cards-with-proxies/" class="nav-list-link active">Collect and Use Credit Cards with Proxies</a> </div><div class="nav-list-item"> <a href="https://developers.basistheory.com/guides/migrating-off-basis-theory/" class="nav-list-link ">Migrating off Basis Theory</a> </div><div class="guide-subcategory-title">MANAGE YOUR DATA</div><div class="nav-list-item"> <a href="https://developers.basistheory.com/guides/manage-applications-with-terraform/" class="nav-list-link ">Manage Applications with Terraform</a> </div><div class="nav-list-item"> <a href="https://developers.basistheory.com/guides/manage-reactor-formulas-with-terraform/" class="nav-list-link ">Manage Reactor Formulas with Terraform</a> </div></div> <div class="side-bar-category" id="reference-category-name-and-icon"> <div class="icon-and-category-name"> <div class="reference-icon category-icon-spacing"></div> <div class="side-bar-category-name">Reference</div> </div> <a class="category-expander" id="reference-category-expander"></a> </div> <div class="side-bar-category-items" id="reference-category-items"> <div class="nav-list-item"> <a href="https://docs.basistheory.com/api-reference/#introduction" class="nav-list-link">API Reference</a> <a href="https://status.basistheory.com" target="_blank" class="nav-list-link">System Status</a> <a href="https://docs.basistheory.com/elements/#introduction" class="nav-list-link">Elements</a> <a href="https://docs.basistheory.com/expressions/#introduction" class="nav-list-link">Expressions</a> </div> </div> <a class="side-bar-category" href="/labs"> <div class="icon-and-category-name"> <div class="labs-icon category-icon-spacing "></div> <div class="side-bar-category-name ">Basis Theory Labs</div> </div> </a> </div> </nav> <footer class="site-footer"> </footer> </div> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Basis Theory Guides" aria-label="Search Basis Theory Guides" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"> <use xlink:href="#svg-search"></use> </svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div class="main" id="top"> <div id="main-content-wrap" class="main-content-wrap"> <div id="main-content" class="main-content" role="main"> <h1 class="no_toc" id="collect-and-use-credit-cards-with-proxies">Collect and Use Credit Cards with Proxies</h1> <p>By the end of this guide, you will have learned how to use Basis Theory‚Äôs Proxies to accept Credit Card data in your API - all without touching the card data or pulling your system into PCI scope. In this example, we will configure the Proxy to utilize a Reactor to remove any sensitive data, forward the desensitized request to an API, and finally respond to the originator.</p> <p>For this guide, we will be using the following scenario:</p> <ul> <li>We will accept card data via Basis Theory‚Äôs API from one of our partners. The request body will be as follows: <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"merchantAccount"</span><span class="p">:</span><span class="w"> </span><span class="s2">"TestMerchant"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"card"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"expiryMonth"</span><span class="p">:</span><span class="w"> </span><span class="s2">"8"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"expiryYear"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2018"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"holderName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Test"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"number"</span><span class="p">:</span><span class="w"> </span><span class="s2">"4111111111111111"</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div> </div> </li> <li>We will tokenize the credit card number</li> <li>We will forward the request with the new tokenized card to <code class="language-plaintext highlighter-rouge">https://httpbin.org/post</code> (this can be replaced by your API)</li> <li>Once <code class="language-plaintext highlighter-rouge">https://httpbin.org/post</code> responds, this response will become the response to our partner‚Äôs original call.</li> </ul> <h3 class="no_toc text-delta" id="table-of-contents">Table of contents</h3> <ol id="markdown-toc"> <li><a href="#1-create-a-new-management-application" id="markdown-toc-1-create-a-new-management-application">1. Create a new Management Application</a></li> <li><a href="#2-create-a-reactor-formula-to-handle-the-inbound-request" id="markdown-toc-2-create-a-reactor-formula-to-handle-the-inbound-request">2. Create a Reactor Formula to handle the inbound request</a></li> <li><a href="#3-create-a-new-application" id="markdown-toc-3-create-a-new-application">3. Create a new Application</a></li> <li><a href="#4-create-a-new-reactor" id="markdown-toc-4-create-a-new-reactor">4. Create a new Reactor</a></li> <li><a href="#5-create-a-new-proxy" id="markdown-toc-5-create-a-new-proxy">5. Create a new Proxy</a></li> <li><a href="#6-create-a-new-application-for-our-partner" id="markdown-toc-6-create-a-new-application-for-our-partner">6. Create a new Application for our partner</a></li> <li><a href="#7-call-the-new-proxy" id="markdown-toc-7-call-the-new-proxy">7. Call the new Proxy</a></li> </ol> <h2 id="1-create-a-new-management-application">1. Create a new Management Application</h2> <p>This new management Application will be used to create new Reactor Formulas, <a href="https://developers.basistheory.com/concepts/what-are-reactors/">Reactors</a>, <a href="https://developers.basistheory.com/concepts/access-controls/#what-are-applications/">Applications</a>, and the <a href="https://developers.basistheory.com/concepts/what-is-the-proxy/">Proxy</a>. To enable this configuration, we will configure the Application with the following settings:</p> <ul> <li>Name <ul> <li>‚ÄúSetup Proxy‚Äù</li> </ul> </li> <li>Permissions <ul> <li><code class="language-plaintext highlighter-rouge">application:create</code></li> <li><code class="language-plaintext highlighter-rouge">reactor:create</code></li> <li><code class="language-plaintext highlighter-rouge">proxy:create</code></li> </ul> </li> </ul> <p><a href="https://portal.basistheory.com/applications/create?name=Setup+Proxy&amp;permissions=application%3Acreate&amp;permissions=reactor%3Acreate&amp;permissions=proxy%3Acreate&amp;type=management">You can use this link to pre-fill the Create Application form in our Portal.</a></p> <p><em>Make sure you remember the <code class="language-plaintext highlighter-rouge">key</code> of this new Application, you‚Äôll use this in the following Steps.</em></p> <h2 id="2-create-a-reactor-formula-to-handle-the-inbound-request">2. Create a Reactor Formula to handle the inbound request</h2> <p>We will first create a new Reactor Formula to tokenize the card number in the inbound request. This <a href="https://docs.basistheory.com/#reactor-formulas">Reactor Formula</a> will tokenize the card number and return a new <code class="language-plaintext highlighter-rouge">body</code> with the raw card number replaced with our newly created <a href="https://developers.basistheory.com/concepts/what-are-tokens/">Token</a>.</p> <p>We will use the following code to create our new Reactor Formula:</p> <div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="k">async</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">token</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">req</span><span class="p">.</span><span class="nx">bt</span><span class="p">.</span><span class="nx">tokenize</span><span class="p">({</span>
    <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">token</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">data</span><span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">args</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">card</span><span class="p">.</span><span class="nx">number</span><span class="p">,</span>
    <span class="na">containers</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="s2">/pci/high/</span><span class="dl">"</span><span class="p">]</span>
  <span class="p">});</span>
 
  <span class="kd">const</span> <span class="nx">body</span> <span class="o">=</span> <span class="p">{</span>
    <span class="p">...</span><span class="nx">req</span><span class="p">.</span><span class="nx">args</span><span class="p">.</span><span class="nx">body</span><span class="p">,</span>
    <span class="na">card</span><span class="p">:</span> <span class="p">{</span>
      <span class="p">...</span><span class="nx">req</span><span class="p">.</span><span class="nx">args</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">card</span><span class="p">,</span>
      <span class="na">number</span><span class="p">:</span> <span class="nx">token</span><span class="p">.</span><span class="nx">id</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="p">{</span>
    <span class="na">raw</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">headers</span><span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">args</span><span class="p">.</span><span class="nx">headers</span><span class="p">,</span>
      <span class="nx">body</span>
    <span class="p">}</span>
  <span class="p">};</span>
<span class="p">};</span>
</code></pre></div></div> <p>Use the following <code class="language-plaintext highlighter-rouge">curl</code> command to create a new Reactor Formula:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="s2">"https://api.basistheory.com/reactor-formulas"</span> <span class="se">\</span>
  <span class="nt">-H</span> <span class="s2">"BT-API-KEY: &lt;API Key from Step 1&gt;"</span> <span class="se">\</span>
  <span class="nt">-H</span> <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
  <span class="nt">-X</span> <span class="s2">"POST"</span> <span class="se">\</span>
  <span class="nt">-d</span> <span class="s1">'{
    "type": "private",
    "status": "verified",
    "name": "Partner Proxy Formula",
    "description": "Used to tokenized cards on the way to /payments",
    "icon": "data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg==",
    "code": "module.exports = async function (req) {\r\n  const token = await req.bt.tokenize({\r\n\t  type: \"token\",\r\n\t  data: req.args.body.card.number,\r\n\t\tcontainers: [\"/pci/high/\"]\r\n\t});\r\n \r\n\tconst body = {\r\n\t\t...req.args.body,\r\n    card: {\r\n      ...req.args.body.card,\r\n      number: token.id\r\n    }\r\n\t}\r\n\r\n  return {\r\n\t\traw: {\r\n\t\t\theaders: req.args.headers,\r\n\t\t\tbody\r\n\t\t}\r\n\t};\r\n};",
    "configuration": [],
    "request_parameters": []
}'</span>
</code></pre></div></div> <p><em>Make sure you remember the <code class="language-plaintext highlighter-rouge">id</code> of this new Reactor Formula, you‚Äôll use this in Step 3.</em></p> <h2 id="3-create-a-new-application">3. Create a new Application</h2> <p>This Application will be used by your Reactor to grant the injected <code class="language-plaintext highlighter-rouge">bt</code> <a href="https://www.npmjs.com/package/@basis-theory/basis-theory-js">npm module</a> instance access to create new tokens in the <code class="language-plaintext highlighter-rouge">/pci/</code> container.</p> <p>Create a new Application with the following settings:</p> <ul> <li>Name <ul> <li>Create and Use Reactors Application</li> </ul> </li> <li>Type <ul> <li>Private</li> </ul> </li> <li>Permissions <ul> <li><code class="language-plaintext highlighter-rouge">token:create</code></li> <li><code class="language-plaintext highlighter-rouge">token:use</code></li> </ul> </li> </ul> <p><a href="https://portal.basistheory.com/applications/create?application_template_id=6a67691b-14c2-41f9-96f6-bf3bfbe6fa31">Click here to create a new Application</a> or you can make the following request with your Management API Key from Step 1:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="s2">"https://api.basistheory.com/applications"</span> <span class="se">\</span>
  <span class="nt">-H</span> <span class="s2">"BT-API-KEY: &lt;API Key from Step 1&gt;"</span> <span class="se">\</span>
  <span class="nt">-H</span> <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
  <span class="nt">-X</span> <span class="s2">"POST"</span> <span class="se">\</span>
  <span class="nt">-d</span> <span class="s1">'{
    "name": "Create and Use Reactors",
    "type": "private",
    "permissions": [
      "token:create",
      "token:use"
    ]
  }'</span>
</code></pre></div></div> <p><em>Make sure you remember the <code class="language-plaintext highlighter-rouge">id</code> of this new Application, you‚Äôll use this in Step 4. When creating the Application through the Portal, you can find the Application <code class="language-plaintext highlighter-rouge">id</code> in the last part of the URL path when viewing details for the Application.</em></p> <h2 id="4-create-a-new-reactor">4. Create a new Reactor</h2> <p>Use the following <code class="language-plaintext highlighter-rouge">curl</code> command to create a new Reacotr using the Reactor Formula id we‚Äôve created in Step 2 and the Application id created in Step 3:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="s2">"https://api.basistheory.com/reactors"</span> <span class="se">\</span>
  <span class="nt">-H</span> <span class="s2">"BT-API-KEY: &lt;API Key from Step 1&gt;"</span> <span class="se">\</span>
  <span class="nt">-H</span> <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
  <span class="nt">-X</span> <span class="s2">"POST"</span> <span class="se">\</span>
  <span class="nt">-d</span> <span class="s1">'{
    "name": "Partner Proxy",
    "application": {
      "id": "&lt;Application Id from Step 3&gt;"
    },
    "formula": {
      "id": "&lt;Reactor Formula Id from Step 2&gt;"
    }
  }'</span>
</code></pre></div></div> <p><em>Make sure you remember the <code class="language-plaintext highlighter-rouge">id</code> of this new Reactor, you‚Äôll use this in Step 5.</em></p> <h2 id="5-create-a-new-proxy">5. Create a new Proxy</h2> <p>Using our newly created Reactor (from Step 4) configure a new Proxy. When created, a new <code class="language-plaintext highlighter-rouge">key</code> will be generated for that Proxy. When that Proxy is used it will invoke the specified Reactor and forward the output to your specified <code class="language-plaintext highlighter-rouge">destination_url</code>. Anything responded from your <code class="language-plaintext highlighter-rouge">destination_url</code> will be ultimately returned to the original caller.</p> <p>Use the following <code class="language-plaintext highlighter-rouge">curl</code> command to create a proxy:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="s2">"https://api.basistheory.com/proxies"</span> <span class="se">\</span>
  <span class="nt">-H</span> <span class="s2">"BT-API-KEY: &lt;API Key from Step 1&gt;"</span> <span class="se">\</span>
  <span class="nt">-H</span> <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
  <span class="nt">-X</span> <span class="s2">"POST"</span> <span class="se">\</span>
  <span class="nt">-d</span> <span class="s1">'{
    "name": "Partner Proxy",
    "request_reactor_id": "&lt;Reactor Id from Step 4&gt;",
    "destination_url": "https://httpbin.org/post"
  }'</span>
</code></pre></div></div> <p><span class="base-alert info"> <span> Substitute the <code class="language-plaintext highlighter-rouge">destination_url</code> for your API whenever you‚Äôre ready to receive requests </span> </span></p> <p>This will respond with the following:</p> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"e3337cfe-3e50-45b9-a847-e29a50980ca5"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"tenant_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"c290ba6f-9214-4de1-8948-9f0fe2481807"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Partner Proxy"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"e29a50980ca5"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"request_reactor_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;Reactor Id from Step 4&gt;"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"destination_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://httpbin.org/post"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"require_auth"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
  </span><span class="err">...</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div> <p><em>Make sure you remember the <code class="language-plaintext highlighter-rouge">key</code> of this new Proxy, you‚Äôll use this in Step 7.</em></p> <h2 id="6-create-a-new-application-for-our-partner">6. Create a new Application for our partner</h2> <p>By default, all Proxies require auth. In order to grant access to call a Proxy, we‚Äôll need to create a new Application with permissions to use this Proxy.</p> <p>Create a new Application with the following settings:</p> <ul> <li>Name <ul> <li>Partner Application</li> </ul> </li> <li>Type <ul> <li>Private</li> </ul> </li> <li>Permissions <ul> <li><code class="language-plaintext highlighter-rouge">token:use</code></li> </ul> </li> </ul> <p><a href="https://portal.basistheory.com/applications/application_template_id=31efed55-035c-4b49-b1a1-609a728d91ce">Click here to create a new Application</a> or you can make the following request with your Management API Key from Step 1:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="s2">"https://api.basistheory.com/applications"</span> <span class="se">\</span>
  <span class="nt">-H</span> <span class="s2">"BT-API-KEY: &lt;API Key from Step 1&gt;"</span> <span class="se">\</span>
  <span class="nt">-H</span> <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
  <span class="nt">-X</span> <span class="s2">"POST"</span> <span class="se">\</span>
  <span class="nt">-d</span> <span class="s1">'{
    "name": "Partner Application",
    "type": "private",
    "permissions": [
      "token:use"
    ]
  }'</span>
</code></pre></div></div> <p><em>Make sure you remember the <code class="language-plaintext highlighter-rouge">key</code> of this new Application, you‚Äôll use this in Step 7.</em></p> <h2 id="7-call-the-new-proxy">7. Call the new Proxy</h2> <p>Using the new Proxy endpoint our partner can call this endpoint:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="s2">"https://api.basistheory.com/proxy"</span> <span class="se">\</span>
  <span class="nt">-H</span> <span class="s2">"BT-API-KEY: &lt;API Key from Step 6&gt;"</span> <span class="se">\</span>
  <span class="nt">-H</span> <span class="s2">"BT-PROXY-KEY: &lt;Proxy Key from Step 5&gt;"</span> <span class="se">\</span>
  <span class="nt">-H</span> <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
  <span class="nt">-X</span> <span class="s2">"POST"</span> <span class="se">\</span>
  <span class="nt">-d</span> <span class="s1">'{
    "merchantAccount": "TestMerchant",
    "card": {
        "expiryMonth": "8",
        "expiryYear": "2018",
        "holderName": "Test",
        "number": "4111111111111111"
    }
  }'</span>
</code></pre></div></div> <p>The request to the <code class="language-plaintext highlighter-rouge">destination_url</code> will look like the following:</p> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"merchantAccount"</span><span class="p">:</span><span class="w"> </span><span class="s2">"TestMerchant"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"card"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"expiryMonth"</span><span class="p">:</span><span class="w"> </span><span class="s2">"8"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"expiryYear"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2018"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"holderName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Test"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"number"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1767a42d-0b1a-400d-8f20-7e35daaf2547"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div> <p>üéâ Success!</p> <p>After placing this call, the endpoint at https://httpbin.org/post will be called and the curl command from Step 6 will have the response from this endpoint.</p> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
